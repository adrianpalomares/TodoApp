<html>
  <head>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      table {
        margin-top: 20px;
      }
      .editButton {
        margin-right: 5px;
      }
    </style>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <title>Todo App</title>
  </head>
  <body>
    <div class="container">
      <!-- Input form -->

      Title:
      <input id="titleField" type="text" name="title" />
      <br />
      Content:
      <input id="contentField" type="text" name="content" />

      <div>
        <button id="test-button">Add</button>
      </div>

      <!-- Table with todos -->
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Content</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="todoTable"></tbody>
      </table>
    </div>

    <!-- JavaScript -->
    <script>
      // Get all todos and add to table
      fetch("http://127.0.0.1:3000/api/todos")
        .then(response => response.json())
        .then(response => {
          response.forEach(function(todo) {
            // console.log(todo);
            let todoTr = document.createElement("tr");

            //Title
            let todoTitle = document.createElement("td");
            todoTitle.append(document.createTextNode(todo.title));
            todoTr.append(todoTitle);

            //Content
            let todoContent = document.createElement("td");
            todoContent.append(document.createTextNode(todo.content));
            todoTr.append(todoContent);

            //Action
            let todoAction = document.createElement("td");

            //Edit Button
            let editButton = document.createElement("button");
            editButton.id = todo._id;
            editButton.setAttribute("class", "btn btn-primary editButton");
            editButton.innerText = "Edit";
            //Event listener for api
            editButton.addEventListener("click", function() {
              window.location.href = "http://127.0.0.1:3000/edit/" + todo._id;
            });
            todoTr.append(editButton);

            //Delete Button
            let deleteButton = document.createElement("button");
            deleteButton.id = todo._id;
            deleteButton.setAttribute("class", "btn btn-danger deleteButton");
            deleteButton.innerText = "Delete";
            // Event listener to send to api
            deleteButton.addEventListener("click", function() {
              console.log(this.id);
              //Send delete request
              fetch("http://127.0.0.1:3000/api/todos/" + this.id, {
                method: "DELETE"
              });
              // Refresh page
              location.reload();
            });

            todoTr.append(deleteButton);

            //Add to table
            document.getElementById("todoTable").append(todoTr);
          });
        });

      // The test button
      let testBtn = document.getElementById("test-button");

      // The todo list
      let todoList = document.getElementById("todoList");

      function fetchJson() {
        fetch("http://127.0.0.1:3000/api/todos")
          .then(response => response.json())
          .then(resJson => console.log(resJson));
      }
      // Adding a todo
      testBtn.addEventListener("click", function() {
        let titleField = document.getElementById("titleField").value;
        let contentField = document.getElementById("contentField").value;

        //complete this if statement
        if (titleField == "") {
          console.log("null");
        } else {
          fetch("http://127.0.0.1:3000/api/todos", {
            method: "POST",
            headers: {
              Accept: "application/json, text/plain, */*",
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              title: titleField,
              content: contentField
            })
          });

          location.reload();
        }
      });
    </script>
  </body>
</html>
